jQuery((function(e){function t(t){if(t.getAttribute("data-dependencies")){let r=t.getAttribute("data-dependencies");r=r.replaceAll("'",'"');let a=JSON.parse(r),o=e(t).closest(".repeater"),n=!1;for(let e of a){let t=!0;for(let r of e){let e=r.field;e=e.replace("field_","");const a=o.find(`[name="${e}"]`).val();if(!r.values.includes(a)){t=!1;break}}if(t){n=!0;break}}n?e(t).closest(".form-group").show():e(t).closest(".form-group").hide()}}function r(){e(".repeater").each((function(){e(this).find("input, select, textarea").each((function(){t(this)}))}))}r(),e(document).on("click",".repeater .title",(function(){e(this).closest(".repeater").toggleClass("closed"),e(".CodeMirror").each((function(e,t){t.CodeMirror.refresh()}))}));let a=function(r){let a=r.children(".repeater"),o=r.parents(".repeater-wrapper").length>0,n={};for(let i=0;i<a.length;i++){let l=a[i].classList.contains("default")?"default":"new",p=a[i].querySelectorAll("input, select, textarea"),s={},c={};for(let r=0;r<p.length;r++){let a=p[r],n=a.getAttribute("name"),i=e(a).parents(".repeater-wrapper").length>1;if("config"!==n&&(o||!i)){if("repeater_identifier"===n||"default_values"===n)s[n]=a.value.trim();else{let t=a.value.trim();if("checkbox"!==a.getAttribute("data-type")&&"toggle"!==a.getAttribute("data-type")||(t=e(a).is(":checked")?"yes":"no"),"select"===a.getAttribute("data-type")&&e(a).prop("multiple")&&(t=e(a).val().join(",")),"font_picker"===a.getAttribute("data-type")){let e=n.match(/\[(.*)\]/)[1];n=n.split("[")[0],c.hasOwnProperty(e)||(c[e]=t),t=c}s[n]={value:t,type:a.getAttribute("data-type")||""}}t(a)}}if(n.hasOwnProperty(l)||(n[l]=[]),n[l].push(s),r.children(".repeater-value").val(JSON.stringify(n)),o){const e=r.closest(".repeater").index(),t=r.find(".repeater-value").attr("name"),a=r.parents(".repeater-wrapper").last(),o=a.find(".repeater").hasClass("new")?"new":"default";let i=a.find(".repeater-value").last().val();i=JSON.parse(i),i.hasOwnProperty(o)||(i[o]=[]),i[o].hasOwnProperty(e)||(i[o][e]=[]),i[o][e].hasOwnProperty(t)||(i[o][e][t]=[]),i[o][e][t]={value:n,type:"repeater"},a.find(".repeater-value").last().val(JSON.stringify(i))}}};e(document).on("click",".add-new-repeater-item",(function(t){t.preventDefault();let a=e(this),o=a.closest(".repeater-wrapper"),n=parseInt(o.attr("data-limit")),i=o.find("> .repeater").length;if(i>=n)return e(".repeater-limit-warning").length||a.after('<span class="repeater-limit-warning">'+pomatio_framework_repeater.limit+"</span>"),void setTimeout((function(){e(".repeater-limit-warning").remove()}),2e3);let l=a.siblings(".repeater-spinner");l.show();let p=a.siblings('[name="config"]').val();e.ajax({url:pomatio_framework_repeater.ajax_url,type:"POST",data:{action:"pomatio_framework_get_repeater_item_html",config:p,items:i},success:function(e){a.before(e),l.hide()}}),e(document).ajaxComplete((function(){void 0!==e.fn.select2&&e(".pomatio-framework-select.multiple").select2(),void 0!==e.fn.wpColorPicker&&e(".pomatio-framework-color-picker").wpColorPicker(),r()}))})),e(document).on("click",".repeater-wrapper .delete",(function(t){if(t.preventDefault(),!confirm(pomatio_framework_repeater.delete_repeater))return;const r=e(this),o=r.closest(".repeater").hasClass("default")?"default":"new",n=r.closest(".repeater-wrapper");if(!(n.parents(".repeater-wrapper").length>0)){const e=r.closest(".repeater").index();let t=n.find(".repeater-value").last().val();return t=JSON.parse(t),t[o].splice(e,1),n.find(".repeater-value").last().val(JSON.stringify(t)),r.closest(".repeater").remove(),void a(n)}n.find(".repeater-value").val(""),r.closest(".repeater").remove(),a(n)})),e(document).on("change",".repeater-wrapper input, .repeater-wrapper textarea, .repeater-wrapper select",(function(){const t=e(this);a(t.closest(".repeater-wrapper"))})),e(document).on("input",'.repeater-wrapper input[data-type="icon_picker"]',(function(){const t=e(this);a(t.closest(".repeater-wrapper"))})),void 0!==e.fn.wpColorPicker&&(e(".pomatio-framework-color-picker").wpColorPicker({change:function(t,r){let o=r.color.toString(),n=e(t.target);n.val(o),a(n.closest(".repeater-wrapper"))}}),e(document).ajaxComplete((function(){e(".pomatio-framework-color-picker").wpColorPicker({change:function(t,r){let o=r.color.toString(),n=e(t.target);n.val(o),a(n.closest(".repeater-wrapper"))}})}))),void 0!==e.fn.sortable&&e(".repeater-wrapper.sortable").sortable({update:function(t,r){a(e(this))}});let o=function(t){let r=t.closest(".repeater").find(".title span").first(),a=function(t){if(t.is("select")){let r=t.find("option:selected");return r.length>0?r.map((function(){return e(this).text().trim()})).get().filter((function(e){return""!==e})).join(", "):""}return t.val()}(t);a?r.html(" - "+a):r.html("")};e(document).on("keyup change",".repeater .use-for-title",(function(){o(e(this))}));let n=function(){e(".repeater-wrapper .use-for-title").each((function(t,r){o(e(this))}))};n(),e(document).ajaxComplete((function(){n()})),e(document).on("click",".restore-default",(function(t){t.preventDefault();let r=e(this),o=r.closest(".repeater-wrapper"),n=r.closest(".repeater").find('input[name="default_values"').val();if(n){let e=JSON.parse(n);Object.keys(e).map((function(t){let a=e[t].value;r.closest(".repeater").find("input, select, checkbox, textarea").each((function(){this.getAttribute("name")===t&&(this.value=a)}))})),a(o)}})),e(document).on("click",".restore-repeater-defaults",(function(t){if(t.preventDefault(),!confirm(pomatio_framework_repeater.restore_msg))return;let r=e(this),o=r.closest(".repeater-wrapper"),n=r.closest(".repeater-wrapper").find(".repeater-spinner");n.show(),o.find(".repeater.default").remove(),e.ajax({url:ajaxurl,type:"POST",data:{action:"pomatio_framework_restore_repeater_defaults",defaults:r.attr("data-defaults"),fields:r.attr("data-fields"),title:r.attr("data-title")},success:function(e){r.closest(".repeater-wrapper").prepend(e),n.hide(),a(o)}})})),e(document).on("click",".clone-repeater",(function(t){t.preventDefault();let r=e(this),o=r.closest(".repeater"),n=r.closest(".repeater-wrapper"),l=o.clone();l.find('input[name="repeater_identifier"]').val(i(10,!1));let p=l.find(".pomatio-framework-code-editor-html, .pomatio-framework-code-editor-js, .pomatio-framework-code-editor-css");for(let t=0;t<p.length;t++)p[t].id=i(10,!1),e(p).next().remove(),wp.codeEditor.initialize(p[t],settings.codeMirrorSettings);l.hasClass("default")&&(l=l.removeClass("default").addClass("new"),l.find('input[name="default_values"]').remove()),o.after(l),a(n)}));let i=function(e=10,t=!0){const r=(t?"0123456789":"")+"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";let a="";for(let t=0;t<e;t++)a+=r[Math.floor(Math.random()*r.length)];return a}}));