jQuery((function(e){function t(t){if(t.getAttribute("data-dependencies")){let r=t.getAttribute("data-dependencies");r=r.replaceAll("'",'"');let a=JSON.parse(r),n=e(t).closest(".repeater"),i=!1;for(let e of a){let t=!0;for(let r of e){let e=r.field;e=e.replace("field_","");const a=n.find(`[name="${e}"]`).val();if(!r.values.includes(a)){t=!1;break}}if(t){i=!0;break}}i?e(t).closest(".form-group").show():e(t).closest(".form-group").hide()}}function r(){e(".repeater").each((function(){e(this).find("input, select, textarea").each((function(){t(this)}))}))}r(),e(document).on("click",".repeater .title",(function(){e(this).closest(".repeater").toggleClass("closed"),e(".CodeMirror").each((function(e,t){t.CodeMirror.refresh()}))}));let a=function(e){let t=e.find(".title .repeater-identifier");if(!t.length)return;let r=e.find('input[name="repeater_identifier"]').val();r?t.html(" - ID: "+r):t.html("")},n=function(r){let n=r.children(".repeater"),i=r.parents(".repeater-wrapper").length>0,o={};for(let l=0;l<n.length;l++){let p=n[l].classList.contains("default")?"default":"new";a(e(n[l]));let s=n[l].querySelectorAll("input, select, textarea"),c={},f={};for(let r=0;r<s.length;r++){let a=s[r],n=a.getAttribute("name"),o=e(a).parents(".repeater-wrapper").length>1;if("config"!==n&&(i||!o)){if("repeater_identifier"===n||"default_values"===n)c[n]=a.value.trim();else{let t=a.value.trim();if("checkbox"!==a.getAttribute("data-type")&&"toggle"!==a.getAttribute("data-type")||(t=e(a).is(":checked")?"yes":"no"),"select"===a.getAttribute("data-type")&&e(a).prop("multiple")&&(t=e(a).val().join(",")),"font_picker"===a.getAttribute("data-type")){let e=n.match(/\[(.*)\]/)[1];n=n.split("[")[0],f.hasOwnProperty(e)||(f[e]=t),t=f}c[n]={value:t,type:a.getAttribute("data-type")||""}}t(a)}}if(o.hasOwnProperty(p)||(o[p]=[]),o[p].push(c),r.children(".repeater-value").val(JSON.stringify(o)),i){const e=r.closest(".repeater").index(),t=r.find(".repeater-value").attr("name"),a=r.parents(".repeater-wrapper").last(),n=a.find(".repeater").hasClass("new")?"new":"default";let i=a.find(".repeater-value").last().val();i=JSON.parse(i),i.hasOwnProperty(n)||(i[n]=[]),i[n].hasOwnProperty(e)||(i[n][e]=[]),i[n][e].hasOwnProperty(t)||(i[n][e][t]=[]),i[n][e][t]={value:o,type:"repeater"},a.find(".repeater-value").last().val(JSON.stringify(i))}}};e(document).on("click",".add-new-repeater-item",(function(t){t.preventDefault();let a=e(this),n=a.closest(".repeater-wrapper"),i=parseInt(n.attr("data-limit")),o=n.find("> .repeater").length;if(o>=i)return e(".repeater-limit-warning").length||a.after('<span class="repeater-limit-warning">'+pomatio_framework_repeater.limit+"</span>"),void setTimeout((function(){e(".repeater-limit-warning").remove()}),2e3);let l=a.siblings(".repeater-spinner");l.show();let p=a.siblings('[name="config"]').val();e.ajax({url:pomatio_framework_repeater.ajax_url,type:"POST",data:{action:"pomatio_framework_get_repeater_item_html",config:p,items:o},success:function(e){a.before(e),l.hide()}}),e(document).ajaxComplete((function(){void 0!==e.fn.select2&&e(".pomatio-framework-select.multiple").select2(),void 0!==e.fn.wpColorPicker&&e(".pomatio-framework-color-picker").wpColorPicker(),r()}))})),e(document).on("click",".repeater-wrapper .delete",(function(t){if(t.preventDefault(),!confirm(pomatio_framework_repeater.delete_repeater))return;const r=e(this),a=r.closest(".repeater").hasClass("default")?"default":"new",i=r.closest(".repeater-wrapper");if(!(i.parents(".repeater-wrapper").length>0)){const e=r.closest(".repeater").index();let t=i.find(".repeater-value").last().val();return t=JSON.parse(t),t[a].splice(e,1),i.find(".repeater-value").last().val(JSON.stringify(t)),r.closest(".repeater").remove(),void n(i)}i.find(".repeater-value").val(""),r.closest(".repeater").remove(),n(i)})),e(document).on("change",".repeater-wrapper input, .repeater-wrapper textarea, .repeater-wrapper select",(function(){const t=e(this);n(t.closest(".repeater-wrapper"))})),e(document).on("input",'.repeater-wrapper input[data-type="icon_picker"]',(function(){const t=e(this);n(t.closest(".repeater-wrapper"))})),void 0!==e.fn.wpColorPicker&&(e(".pomatio-framework-color-picker").wpColorPicker({change:function(t,r){let a=r.color.toString(),i=e(t.target);i.val(a),n(i.closest(".repeater-wrapper"))}}),e(document).ajaxComplete((function(){e(".pomatio-framework-color-picker").wpColorPicker({change:function(t,r){let a=r.color.toString(),i=e(t.target);i.val(a),n(i.closest(".repeater-wrapper"))}})}))),void 0!==e.fn.sortable&&e(".repeater-wrapper.sortable").sortable({update:function(t,r){n(e(this))}});let i=function(t){let r=t.closest(".repeater").find(".title span").first(),a=function(t){if(t.is("select")){let r=t.find("option:selected");return r.length>0?r.map((function(){return e(this).text().trim()})).get().filter((function(e){return""!==e})).join(", "):""}return t.val()}(t);a?r.html(" - "+a):r.html("")};e(document).on("keyup change",".repeater .use-for-title",(function(){i(e(this))}));let o=function(){e(".repeater-wrapper .use-for-title").each((function(t,r){i(e(this))})),e(".repeater-wrapper .repeater").each((function(){a(e(this))}))};o(),e(document).ajaxComplete((function(){o()})),e(document).on("click",".restore-default",(function(t){t.preventDefault();let r=e(this),a=r.closest(".repeater-wrapper"),i=r.closest(".repeater").find('input[name="default_values"').val();if(i){let e=JSON.parse(i);Object.keys(e).map((function(t){let a=e[t].value;r.closest(".repeater").find("input, select, checkbox, textarea").each((function(){this.getAttribute("name")===t&&(this.value=a)}))})),n(a)}})),e(document).on("click",".restore-repeater-defaults",(function(t){if(t.preventDefault(),!confirm(pomatio_framework_repeater.restore_msg))return;let r=e(this),a=r.closest(".repeater-wrapper"),i=r.closest(".repeater-wrapper").find(".repeater-spinner");i.show(),a.find(".repeater.default").remove(),e.ajax({url:ajaxurl,type:"POST",data:{action:"pomatio_framework_restore_repeater_defaults",defaults:r.attr("data-defaults"),fields:r.attr("data-fields"),title:r.attr("data-title")},success:function(e){r.closest(".repeater-wrapper").prepend(e),i.hide(),n(a)}})})),e(document).on("click",".clone-repeater",(function(t){t.preventDefault();let r=e(this),i=r.closest(".repeater"),o=r.closest(".repeater-wrapper"),p=i.clone();p.find('input[name="repeater_identifier"]').val(l(10,!1)),a(p);let s=p.find(".pomatio-framework-code-editor-html, .pomatio-framework-code-editor-js, .pomatio-framework-code-editor-css");for(let t=0;t<s.length;t++)s[t].id=l(10,!1),e(s).next().remove(),wp.codeEditor.initialize(s[t],settings.codeMirrorSettings);p.hasClass("default")&&(p=p.removeClass("default").addClass("new"),p.find('input[name="default_values"]').remove()),i.after(p),n(o)}));let l=function(e=10,t=!0){const r=(t?"0123456789":"")+"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";let a="";for(let t=0;t<e;t++)a+=r[Math.floor(Math.random()*r.length)];return a}}));