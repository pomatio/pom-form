jQuery((function(e){let t,i,l=function(){e(".gallery-wrapper .item-wrapper").each((function(){e(this).find("img").length&&e(this).closest(".gallery-wrapper").find(".remove-selected-item").css("display","inherit")}))};l(),void 0!==e.fn.sortable&&e(".items-wrapper").sortable({update:function(t,i){let l=e(this);if(!l.closest(".gallery-wrapper").find('input[type="hidden"]').val().split(","))return!0;let n=[];l.children(".item-wrapper").each((function(){n.push(e(this).find(".remove-selected-item").attr("data-id"))})),l.closest(".gallery-wrapper").find('input[type="hidden"]').val(n.toString())}}),e(document).on("click",".open-gallery-modal",(function(n){n.preventDefault(),t=e(this),i?i.open():(i=wp.media({title:pom_form_gallery.title,multiple:"add"}),i.on("select",(function(){let e=i.state().get("selection"),n=[],r=[],a=0;e.each((function(e){n[a]=e.id,r[a]=e.attributes.sizes.thumbnail.url,a++})),t.closest(".gallery-wrapper").find('input[type="hidden"]').val(n.toString()),t.closest(".gallery-wrapper").find(".items-wrapper").empty(),a=0,r.forEach((function(e){t.closest(".gallery-wrapper").find(".items-wrapper").append('<div class="item-wrapper"><span class="remove-selected-item dashicons dashicons-trash" data-id="'+n[a]+'"></span><img src="'+e+'" alt=""></div>'),a++})),l()})),i.on("open",(function(){let e=i.state().get("selection");if(!t.closest(".gallery-wrapper").find('input[type="hidden"]').val())return;let l=t.closest(".gallery-wrapper").find('input[type="hidden"]').val().split(",");l&&l.forEach((function(t){let i=wp.media.attachment(t);i.fetch(),i&&(e.add([i]),l.push(i.cid))}))})))})),e(document).on("click",".gallery-wrapper .remove-selected-item",(function(t){t.preventDefault();let i=e(this),l=i.attr("data-id"),n=i.closest(".gallery-wrapper").find('input[type="hidden"]').val().split(",");const r=n.indexOf(l);r>-1&&n.splice(r,1),i.closest(".gallery-wrapper").find('input[type="hidden"]').val(n.toString()),i.closest(".item-wrapper").remove()}))}));